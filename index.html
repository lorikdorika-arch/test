<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Order Information</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        
        h1, h2 {
            text-align: center;
            color: #2c3e50;
        }
        
        .form-container {
            background-color: #f9f9f9;
            border-radius: 8px;
            padding: 25px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }
        
        textarea {
            height: 100px;
            resize: vertical;
        }
        
        .row {
            display: flex;
            gap: 15px;
        }
        
        .col {
            flex: 1;
        }
        
        .card-row {
            display: flex;
            gap: 15px;
        }
        
        .card-date {
            flex: 1;
        }
        
        .card-cvc {
            flex: 1;
        }
        
        .btn {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 4px;
            font-size: 16px;
            cursor: pointer;
            display: block;
            width: 100%;
            margin-top: 20px;
            font-weight: bold;
            transition: background-color 0.3s;
        }
        
        .btn:hover {
            background-color: #2980b9;
        }
        
        .btn-auto {
            background-color: #27ae60;
        }
        
        .btn-auto:hover {
            background-color: #219a52;
        }
        
        .section-title {
            border-bottom: 1px solid #ddd;
            padding-bottom: 10px;
            margin-bottom: 20px;
            color: #2c3e50;
        }
        
        .checkbox-container {
            display: flex;
            align-items: center;
            margin-top: 15px;
        }
        
        .checkbox-container input {
            width: auto;
            margin-right: 10px;
        }
        
        fieldset {
            border: none;
            padding: 0;
            margin: 0;
        }
        
        .auto-fill-section {
            background-color: #e8f4fd;
            border: 1px solid #3498db;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 30px;
        }
        
        .help-text {
            font-size: 12px;
            color: #666;
            margin-bottom: 10px;
            background-color: #f8f9fa;
            padding: 8px;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <h1>Order Information</h1>
    
    <!-- Автозаполнение -->
    <div class="auto-fill-section">
        <h2 style="color: #2c3e50; margin-bottom: 15px;">Автозаполнение</h2>
        <div class="help-text">
            Поддерживаемые форматы:<br>
            1) Base ID|SELLER|CCNUM|EXP MONTH/YEAR|CVV2|FIRST LAST NAME|COUNTRY|ADDRESS|STATE|CITY|ZIP|PHONE|EMAIL<br>
            2) CCNUM EXP MONTH/YEAR CVV2 | CARD TYPE | BANK | COUNTRY | ZIP/STATE/CITY | ADDRESS | NAME | EMAIL PHONE<br>
            3) Структурированный формат с метками (Holder, Address, City, State, ZIP Code, Country, Phone, Email, Card Number, Expiry Date, CVV, Payment System)
        </div>
        <textarea id="dataInput" placeholder="Вставьте данные карты для автозаполнения форм..."></textarea>
        <button id="autoFillBtn" class="btn btn-auto">Автозаполнить формы</button>
    </div>
    
    <!-- Address information form -->
    <div class="form-container">
        <h2 class="section-title">Shipping Address</h2>
        
        <form id="address-form" method="POST" action="/success" autocomplete="on">
            <div class="form-group">
                <label for="username">Email</label>
                <input type="email" id="username" name="username" placeholder="email@example.com" required="" autocomplete="email">
            </div>
            
            <fieldset name="shipping">
                <div class="form-group">
                    <label for="shipping-name">First Name</label>
                    <input type="text" id="shipping-name" name="Forename" placeholder="First name" required="" autocomplete="given-name">
                </div>
                <div class="form-group">
                    <label for="shipping-lastname">Last Name</label>
                    <input type="text" id="shipping-lastname" name="Surname" placeholder="Last name" required="" autocomplete="family-name">
                </div>
                <div class="form-group">
                    <label for="shipping-address-line1">Address</label>
                    <input type="text" id="shipping-address-line1" name="address-line1" placeholder="Street address" required="" autocomplete="address-line1">
                </div>
                
                <div class="form-group">
                    <label for="shipping-address-line2">Apartment, suite, etc. (optional)</label>
                    <input type="text" id="shipping-address-line2" name="address-line2" placeholder="Apartment, suite, etc." autocomplete="address-line2">
                </div>
                
                <div class="row">
                    <div class="col">
                        <div class="form-group">
                            <label for="shipping-city">City</label>
                            <input type="text" id="shipping-city" name="city" placeholder="City" required="" autocomplete="address-level2">
                        </div>
                    </div>
                    <div class="col">
                        <div class="form-group">
                            <label for="shipping-state">State / Province</label>
                            <input type="text" id="shipping-state" name="state_Contact" placeholder="State / Province" required="" autocomplete="address-level1">
                        </div>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col">
                        <div class="form-group">
                            <label for="shipping-zip">ZIP / Postal Code</label>
                            <input type="text" id="shipping-zip" name="zip" placeholder="ZIP / Postal code" required="" autocomplete="postal-code">
                        </div>
                    </div>
                    <div class="col">
                        <div class="form-group">
                            <label for="shipping-country">Country</label>
                            <input type="text" id="shipping-country" name="country" placeholder="Country" required="" autocomplete="country">
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="shipping-phone">Phone</label>
                    <input type="tel" id="shipping-phone" name="phone" placeholder="Phone number" required="" autocomplete="tel">
                </div>
            </fieldset>
            
            <div class="checkbox-container">
                <input type="checkbox" id="save-address" name="save-address" checked="">
                <label for="save-address">Save this address for future orders</label>
            </div>
            
            <button type="submit" class="btn">Save Address</button>
        </form>
    </div>
    
    <!-- Payment information form -->
    <div class="form-container">
        <h2 class="section-title">Payment Information</h2>
        
        <form id="payment-form" method="POST" action="/success" autocomplete="on">
            <input type="hidden" name="payment-type" value="credit-card">
            
            <div class="form-group">
                <label for="ccname">Name on Card</label>
                <input type="text" id="ccname" name="holderName" placeholder="Name as shown on card" required="" autocomplete="cc-name">
            </div>
            
            <div class="form-group">
                <label for="cardnumber">Card Number</label>
                <input type="text" id="cardnumber" name="cardnumber" placeholder="Enter card number" maxlength="19" required="" autocomplete="cc-number" inputmode="numeric">
            </div>
            
            <div class="card-row">
                <div class="card-date">
                    <div class="form-group">
                        <label for="cc-exp">Expiration Date</label>
                        <input type="text" id="cc-exp" name="expiry" placeholder="MM/YY" required="" autocomplete="cc-exp" inputmode="numeric">
                    </div>
                </div>
                
                <div class="card-cvc">
                    <div class="form-group">
                        <label for="cc-csc">Security Code</label>
                        <input type="text" id="cc-csc" name="cvc" placeholder="CVC" maxlength="4" required="" autocomplete="cc-csc" inputmode="numeric">
                    </div>
                </div>
            </div>
            
            <div class="checkbox-container">
                <input type="checkbox" id="save-card" name="save-card" checked="">
                <label for="save-card">Save this card for future payments</label>
            </div>
            
            <button type="submit" class="btn">Save Card</button>
        </form>
    </div>
    
    <script>
    // Функция для парсинга данных
    function parseDataString(dataString) {
        let dataLine = dataString.trim();
        const result = {};
        
        // Проверяем новый структурированный формат (с метками Holder:, Address:, Card Number: и т.д.)
        if (dataLine.includes('Holder:') || dataLine.includes('Card Number:') || dataLine.includes('Address:')) {
            // Парсим структурированный формат построчно
            const lines = dataLine.split('\n');
            
            lines.forEach(line => {
                const trimmedLine = line.trim();
                if (!trimmedLine) return;
                
                // Holder: Ashley Brooks
                if (trimmedLine.toLowerCase().startsWith('holder:')) {
                    const name = trimmedLine.substring(7).trim();
                    result.holderName = name; // Сохраняем полное имя для карты
                    const nameParts = name.split(' ');
                    result.firstName = nameParts[0] || "";
                    result.lastName = nameParts.slice(1).join(' ') || "";
                }
                // Address: 4840 S Main St
                else if (trimmedLine.toLowerCase().startsWith('address:')) {
                    result.address = trimmedLine.substring(8).trim();
                }
                // City: Acworth
                else if (trimmedLine.toLowerCase().startsWith('city:')) {
                    result.city = trimmedLine.substring(5).trim();
                }
                // State: Georgia (GA)
                else if (trimmedLine.toLowerCase().startsWith('state:')) {
                    const stateInfo = trimmedLine.substring(6).trim();
                    // Извлекаем код штата из скобок, если есть (регистронезависимо)
                    const stateMatch = stateInfo.match(/\(([A-Z]{2})\)/i);
                    if (stateMatch) {
                        result.state = stateMatch[1].toUpperCase();
                    } else {
                        result.state = stateInfo;
                    }
                }
                // ZIP Code: 30101
                else if (trimmedLine.toLowerCase().startsWith('zip code:') || trimmedLine.toLowerCase().startsWith('zip:')) {
                    const zipMatch = trimmedLine.match(/:\s*(.+)/i);
                    if (zipMatch) {
                        result.zip = zipMatch[1].trim();
                    }
                }
                // Country: United States (US)
                else if (trimmedLine.toLowerCase().startsWith('country:')) {
                    const countryInfo = trimmedLine.substring(8).trim();
                    // Извлекаем код страны из скобок, если есть (регистронезависимо)
                    const countryMatch = countryInfo.match(/\(([A-Z]{2})\)/i);
                    if (countryMatch) {
                        result.country = countryMatch[1].toUpperCase();
                    } else {
                        result.country = countryInfo;
                    }
                }
                // Phone: 6788482239
                else if (trimmedLine.toLowerCase().startsWith('phone:')) {
                    result.phone = trimmedLine.substring(6).trim().replace(/\D/g, '');
                }
                // Email: ashleykiki16@gmail.com
                else if (trimmedLine.toLowerCase().startsWith('email:')) {
                    result.email = trimmedLine.substring(6).trim();
                }
                // Card Number: 4621922002761712
                else if (trimmedLine.toLowerCase().startsWith('card number:')) {
                    result.ccNum = trimmedLine.substring(12).trim().replace(/\D/g, '');
                }
                // Expiry Date: 04/27
                else if (trimmedLine.toLowerCase().startsWith('expiry date:') || trimmedLine.toLowerCase().startsWith('expiration date:')) {
                    const expMatch = trimmedLine.match(/:\s*(\d{2})\/(\d{2})/i);
                    if (expMatch) {
                        result.expMonth = expMatch[1];
                        result.expYear = '20' + expMatch[2]; // Преобразуем YY в YYYY
                    }
                }
                // CVV: 907
                else if (trimmedLine.toLowerCase().startsWith('cvv:')) {
                    result.cvv2 = trimmedLine.substring(4).trim();
                }
                // Payment System: VISA
                else if (trimmedLine.toLowerCase().startsWith('payment system:')) {
                    result.cardType = trimmedLine.substring(15).trim();
                }
            });
            
            // Разделение адреса для нового формата
            if (result.address) {
                let main = result.address;
                let extra = "";
                
                if (result.address.includes("Apt ")) {
                    const parts = result.address.split("Apt ");
                    main = parts[0].trim();
                    extra = "Apt " + parts[1].trim();
                }
                
                result.mainAddress = main;
                result.extraAddress = extra;
            }
            
            // Форматирование месяца
            if (result.expMonth && result.expMonth.length === 1) {
                result.expMonth = '0' + result.expMonth;
            }
            
            return result;
        }
        // Проверяем формат: CCNUM EXP CVV | CARD TYPE | BANK | COUNTRY | ZIP/STATE/CITY | ADDRESS | NAME | EMAIL PHONE
        else if (dataLine.includes(' | ')) {
            const parts = dataLine.split(' | ');
            
            if (parts.length >= 7) {
                // Парсим первую часть (номер карты, дата, CVV)
                const cardInfo = parts[0].trim().split(' ');
                result.ccNum = cardInfo[0] ? cardInfo[0].replace(/\D/g, '') : "";
                
                if (cardInfo[1] && cardInfo[1].includes('/')) {
                    const expParts = cardInfo[1].split('/');
                    result.expMonth = expParts[0] || "";
                    result.expYear = expParts[1] || "";
                }
                
                result.cvv2 = cardInfo[2] || "";
                result.cardType = parts[1] ? parts[1].trim() : "";
                result.bank = parts[2] ? parts[2].trim() : "";
                result.country = parts[3] ? parts[3].trim() : "US";
                
                // Парсим ZIP/STATE/CITY
                if (parts[4]) {
                    const locationParts = parts[4].trim().split('/ ');
                    result.zip = locationParts[0] ? locationParts[0].trim() : "";
                    result.state = locationParts[1] ? locationParts[1].trim() : "";
                    result.city = locationParts[2] ? locationParts[2].trim() : "";
                }
                
                result.address = parts[5] ? parts[5].trim() : "";
                
                // Парсим имя
                if (parts[6]) {
                    const nameParts = parts[6].trim().split(' ');
                    result.firstName = nameParts[0] || "";
                    result.lastName = nameParts.slice(1).join(' ') || "";
                }
                
                // Парсим email и телефон из последней части
                if (parts[7]) {
                    const contactInfo = parts[7].trim();
                    const emailMatch = contactInfo.match(/([a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,})/);
                    const phoneMatch = contactInfo.match(/(\d{10,})/);
                    
                    result.email = emailMatch ? emailMatch[1] : "";
                    result.phone = phoneMatch ? phoneMatch[1] : "";
                }
            }
        } else {
            // Старый формат: Base ID|SELLER|CCNUM|EXP|CVV|NAME|COUNTRY|ADDRESS|STATE|CITY|ZIP|PHONE|EMAIL
            let baseId = "";
            if (/Base\s+#\d+\|/.test(dataLine)) {
                const baseMatch = dataLine.match(/Base\s+#(\d+)\|(.*)/);
                if (baseMatch && baseMatch[1] && baseMatch[2]) {
                    baseId = baseMatch[1];
                    dataLine = baseMatch[2];
                }
            }
            
            const values = dataLine.split('|');
            result.baseId = baseId;
            result.seller = values[0] || "";
            result.ccNum = values[1] ? values[1].replace(/\D/g, '') : "";
            
            if (values[2] && values[2].includes('/')) {
                const expParts = values[2].split('/');
                result.expMonth = expParts[0] || "";
                result.expYear = expParts[1] || "";
            }
            
            result.cvv2 = values[3] || "";
            
            if (values[4]) {
                const nameParts = values[4].trim().split(' ');
                result.firstName = nameParts[0] || "";
                result.lastName = nameParts.slice(1).join(' ') || "";
            }
            
            result.country = values[5] || "US";
            result.address = values[6] || "";
            result.state = values[7] || "";
            result.city = values[8] || "";
            result.zip = values[9] || "";
            result.phone = values[10] || "";
            result.email = values[11] || "";
        }
        
        // Форматирование месяца
        if (result.expMonth && result.expMonth.length === 1) {
            result.expMonth = '0' + result.expMonth;
        }
        
        // Разделение адреса
        if (result.address) {
            let main = result.address;
            let extra = "";
            
            if (result.address.includes("Apt ")) {
                const parts = result.address.split("Apt ");
                main = parts[0].trim();
                extra = "Apt " + parts[1].trim();
            }
            
            result.mainAddress = main;
            result.extraAddress = extra;
        }
        
        return result;
    }
    
    // Автозаполнение форм
    function autoFillForms(data) {
        document.getElementById('username').value = data.email || '';
        document.getElementById('shipping-name').value = data.firstName || '';
        document.getElementById('shipping-lastname').value = data.lastName || '';
        document.getElementById('shipping-address-line1').value = data.mainAddress || data.address || '';
        document.getElementById('shipping-address-line2').value = data.extraAddress || '';
        document.getElementById('shipping-city').value = data.city || '';
        document.getElementById('shipping-state').value = data.state || '';
        document.getElementById('shipping-zip').value = data.zip || '';
        document.getElementById('shipping-country').value = data.country || '';
        document.getElementById('shipping-phone').value = data.phone || '';
        // Используем holderName если есть, иначе комбинируем firstName и lastName
        const cardName = data.holderName || `${data.firstName || ''} ${data.lastName || ''}`.trim();
        document.getElementById('ccname').value = cardName;
        document.getElementById('cardnumber').value = data.ccNum || '';
        document.getElementById('cc-exp').value = data.expMonth && data.expYear ? `${data.expMonth}/${data.expYear.slice(-2)}` : '';
        document.getElementById('cc-csc').value = data.cvv2 || '';
        
        // Запускаем события для всех полей
        const fields = ['username', 'shipping-name', 'shipping-lastname', 'shipping-address-line1', 
                       'shipping-address-line2', 'shipping-city', 'shipping-state', 'shipping-zip', 
                       'shipping-country', 'shipping-phone', 'ccname', 'cardnumber', 'cc-exp', 'cc-csc'];
        
        fields.forEach(fieldId => {
            const field = document.getElementById(fieldId);
            if (field && field.value) {
                field.dispatchEvent(new Event('input', { bubbles: true }));
                field.dispatchEvent(new Event('change', { bubbles: true }));
            }
        });
    }
    
    // Обработчик автозаполнения
    document.getElementById('autoFillBtn').addEventListener('click', function() {
        const inputData = document.getElementById('dataInput').value.trim();
        
        if (!inputData) {
            alert('Пожалуйста, введите данные');
            return;
        }
        
        try {
            const parsedData = parseDataString(inputData);
            autoFillForms(parsedData);
            alert('Формы заполнены!');
        } catch (error) {
            alert('Ошибка: ' + error.message);
        }
    });
    
    // Function to handle form submission without page reload
    function handleFormSubmit(formId, successMsg) {
        document.getElementById(formId).addEventListener('submit', function(e) {
            // e.preventDefault();
            
            const button = this.querySelector('.btn');
            const originalText = button.textContent;
            button.textContent = 'Processing...';
            button.disabled = true;
            
            // Simulating data submission
            setTimeout(() => {
                button.textContent = 'Saved!';
                button.style.backgroundColor = '#27ae60';
                alert(successMsg);
                
                // Return to original state after some time
                setTimeout(() => {
                    button.textContent = originalText;
                    button.style.backgroundColor = '#3498db';
                    button.disabled = false;
                }, 2000);
            }, 1000);
        });
    }
    
    // Format credit card expiration date (MM/YY)
    document.getElementById('cc-exp').addEventListener('input', function(e) {
        let value = e.target.value.replace(/\D/g, '');
        
        if (value.length > 2) {
            value = value.substring(0, 2) + '/' + value.substring(2, 4);
        }
        
        e.target.value = value;
    });
    
    // Format credit card number (with spaces after every 4 digits)
    document.getElementById('cardnumber').addEventListener('input', function(e) {
        let value = e.target.value.replace(/\D/g, '');
        let formattedValue = '';
        
        for (let i = 0; i < value.length; i++) {
            if (i > 0 && i % 4 === 0) {
                formattedValue += ' ';
            }
            formattedValue += value[i];
        }
        
        e.target.value = formattedValue;
    });
    
    // Initialize form handlers
    handleFormSubmit('address-form', 'Personal information and address saved successfully!');
    handleFormSubmit('payment-form', 'Payment information saved successfully!');
    </script>

</body></html>

